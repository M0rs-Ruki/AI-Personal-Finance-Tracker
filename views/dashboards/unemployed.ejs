<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Finance | Dashboard</title>
    <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/styles/dashboard/unEmployed.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
        <%
        const currentDate = new Date().toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        const income = unemployed.currentIncome.toLocaleString('en-IN');
        const incomeSources = unemployed.incomeSources;
        <!-- // Calculate total monthly expenses from regularExpenses -->
        const totalExpenses = unemployed.regularExpenses.reduce((sum, expense) => {
            return sum + (expense.frequency === 'monthly' ? expense.amount : 0);
        }, 0);

        const incomeCoverage = totalExpenses > 0
            ? Math.min(100, Math.round((unemployed.currentIncome / totalExpenses) * 100))
            : 0;

        const savings = unemployed.savingsDetails?.amount || 0;
        const emergencyFund = unemployed.savingsDetails?.emergencyFund || 0;

        <!-- // Find emergency fund goal from financialGoals -->
        const emergencyGoal = unemployed.financialGoals.find(goal => goal.type === 'emergency-fund');
        const emergencyGoalTarget = emergencyGoal?.targetAmount || 1; // prevent divide by zero
        const emergencyProgress = Math.round((emergencyFund / emergencyGoalTarget) * 100);
        const runwayMonths = unemployed.savingsDetails?.monthsCovered || 0;
        const runwayPercent = Math.min(100, Math.round((runwayMonths / 6) * 100)); // Assuming 6 months is the upper goal
        let runwayStatus = 'Critical';
        if (runwayMonths >= 3 && runwayMonths < 6) {
            runwayStatus = 'Stable';
        } else if (runwayMonths >= 6) {
            runwayStatus = 'Secure';
        }

        const jobSearchDetails = unemployed.jobSearchDetails;
        
        %>
        <!-- Main Content -->
        <div class="main-content">

            <div class="user-card">
                <div class="user-info">
                    <div class="avatar"><%= user.fullName.charAt(0) %></div>
                    <div class="details">
                        <h2>Hello, <%= user.fullName %></h2>
                        <span class="status">Actively Seeking Employment</span>
                    </div>
                </div>
            
                <div class="user-meta">
                    <span class="beta-badge">BETA</span>
                    <span class="date"><%= currentDate %></span>
                    <div class="actions">
                        <i class="fas fa-cog" onclick="window.location.href='/student/edit'"></i>
                        <i class="fas fa-user-astronaut" onclick="window.location.href='/user/profile'"></i>
                        <i class="fas fa-power-off" onclick="window.location.href='/user/logout'"></i>
                    </div>
                </div>
            </div>

            <div style="padding: 20px;"></div>
            
            <!-- Stats Overview -->
            <div class="stats-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-wallet"></i>
                            <span>Monthly Income</span>
                        </div>
                    </div>
                    <div class="stat-value">₹<%= income %></div>
                    <div class="stat-label">From <%= incomeSources.length %> income source<%= incomeSources.length > 1 ? 's' : '' %></div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= incomeCoverage %>%"></div>
                    </div>
                    <div class="stat-label"><%= incomeCoverage %>% of required expenses</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-piggy-bank"></i>
                            <span>Savings</span>
                        </div>
                    </div>
                    <div class="stat-value">₹<%= savings.toLocaleString('en-IN') %></div>
                    <div class="stat-label">Emergency fund: ₹<%= emergencyFund.toLocaleString('en-IN') %></div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= emergencyProgress %>%"></div>
                    </div>
                    <div class="stat-label"><%= emergencyProgress %>% of your emergency fund goal</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clock"></i>
                            <span>Financial Runway</span>
                        </div>
                    </div>
                    <div class="stat-value"><%= runwayMonths %> Month<%= runwayMonths !== 1 ? 's' : '' %></div>
                    <div class="stat-label">Based on current savings & expenses</div>

                    <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= runwayPercent %>%"></div>
                    </div>
                    <div class="stat-label"><%= runwayStatus %>: Target 3–6 months</div>
                </div>
            </div>
            
            <!-- 2 Column Grid -->
            <div class="grid-2col">
                <!-- Left Column -->
                <div>
                    <%  
                    const industries = jobSearchDetails?.industriesTargeted || [];
                    const skills = jobSearchDetails?.skillsDevelopment || [];
                    %>

                    <!-- Job Search Card -->
                    <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                        <i class="fas fa-briefcase"></i>
                        <span>Job Search Progress</span>
                        </div>
                        <div class="card-actions">
                        <button class="btn">View Details</button>
                        </div>
                    </div>

                    <div class="job-search-stats">
                        <div class="stat-box">
                        <div class="stat-box-value"><%= jobSearchDetails.applicationsPerWeek %></div>
                        <div class="stat-box-label">Applications/Week</div>
                        </div>
                        <div class="stat-box">
                        <div class="stat-box-value">₹<%= jobSearchDetails.jobSearchBudget.toLocaleString('en-IN') %></div>
                        <div class="stat-box-label">Job Search Budget</div>
                        </div>
                        <div class="stat-box">
                        <div class="stat-box-value"><%= industries.length %></div>
                        <div class="stat-box-label">Industries Targeted</div>
                        </div>
                    </div>

                    <div class="stat-label" style="margin-top: 20px;">Skills Development</div>
                    <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                        <% skills.forEach(skill => { %>
                        <span class="badge badge-warning"><%= skill %></span>
                        <% }); %>
                    </div>
                    </div>

                    <%
                    function capitalize(str) {
                    if (str.length === 0) {
                        return ""; // Handle empty strings
                    }
                    return str.charAt(0).toUpperCase() + str.slice(1);
                    }
                    %>
                    <div style="height: 20px;"></div>
                    <!-- Income Sources Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Income Sources</span>
                            </div>
                        </div>
                        
                        <% incomeSources.forEach(source => { %>
                            <div class="income-source">
                                <div>
                                    <div><%= capitalize(source.sourceType) %></div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">
                                        <%= capitalize(source.description) %>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div>₹<%= source.amount.toLocaleString('en-IN') %></div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">
                                        <%= capitalize(source.frequency) %>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                        
                        
                        <div style="background: rgba(255, 171, 0, 0.1); padding: 16px; border-radius: 12px; margin-top: 20px;">
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                                <i class="fas fa-exclamation-circle" style="color: var(--warning); font-size: 20px;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 8px;">Income Alert</div>
                                    <div style="font-size: 14px;">You're relying on family support. Consider diversifying income streams with part-time or gig work.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 20px;"></div>

                    <!-- AI Insights Hub -->
                    <div class="card ai-insights">
                        <div class="ai-header">
                            <div class="flex items-center justify-center gap-2">
                                <i class="fas fa-robot"></i>
                                <span>Inside From Ai</span>
                            </div>
                        </div>
                    
                        <div class="ai-modules">

                            <div class="ai-card">
                                <!-- Title Section -->
                                <div class="ai-card-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <path
                                            d="M21 16V8.00002C20.9996 7.6493 20.9071 7.30483 20.7315 7.00119C20.556 6.69754 20.3037 6.44539 20 6.27002L13 2.27002C12.696 2.09449 12.3511 2.00208 12 2.00208C11.6489 2.00208 11.304 2.09449 11 2.27002L4 6.27002C3.69626 6.44539 3.44398 6.69754 3.26846 7.00119C3.09294 7.30483 3.00036 7.6493 3 8.00002V16C3.00036 16.3508 3.09294 16.6952 3.26846 16.9989C3.44398 17.3025 3.69626 17.5547 4 17.73L11 21.73C11.304 21.9056 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9056 13 21.73L20 17.73C20.3037 17.5547 20.556 17.3025 20.7315 16.9989C20.9071 16.6952 20.9996 16.3508 21 16Z"
                                            stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        <path d="M3.27002 6.95996L12 12.01L20.73 6.95996" stroke="#FFD700" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                        <path d="M12 22.08V12" stroke="#FFD700" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                    Investment Matchmaker
                                </div>

                                <!-- AI Advice Points -->
                                <% unemployed.aiAdvice.split(/\n|•|-|\d+\./).filter(Boolean).forEach(function(point) { %>
                                    <div class="ai-card-content">
                                        <%= point.trim() %>
                                    </div>
                                <% }) %>
                                
                            </div>

                        </div>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div>
                    <!-- Expenses Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                <span>Monthly Expenses</span>
                            </div>
                            <div class="card-actions">
                                <button class="btn">Manage Budget</button>
                            </div>
                        </div>
                        <%
                        const Expenses = unemployed.regularExpenses;
                        %>
                        <% Expenses.forEach(expense => { %>
                            <div class="expense-category">
                                <div class="expense-icon">
                                    <i class="fas fa-home"></i> <!-- You can make icon dynamic if needed -->
                                </div>
                                <div style="flex: 1;">
                                    <div><%= capitalize(expense.category) %></div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">
                                        <%= expense.category === 'Rent' || expense.category === 'Housing' ? 'Housing expense' : 'General expense' %>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div>₹<%= expense.amount.toLocaleString('en-IN') %></div>
                                    <div class="expense-essential"><%= expense.essential ? 'Essential' : 'Non-Essential' %></div>
                                </div>
                            </div>
                        <% }); %>
                        
                        <div style="background: rgba(255, 82, 82, 0.1); padding: 16px; border-radius: 12px; margin-top: 20px;">
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                                <i class="fas fa-exclamation-triangle" style="color: var(--danger); font-size: 20px;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 8px;">Expense Alert</div>
                                    <div style="font-size: 14px;">Your rent exceeds current income. Consider temporary housing alternatives or support options.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 20px;"></div>

                    <%
                    const financialGoals = unemployed.financialGoals || [];

                    function calculateMonthlySaving(goal) {
                        const now = new Date();
                        const targetDate = new Date(goal.targetDate);
                        const monthsLeft = Math.max(1, (targetDate.getFullYear() - now.getFullYear()) * 12 + (targetDate.getMonth() - now.getMonth()));
                        const remainingAmount = goal.targetAmount * (1 - (goal.progress / 100));
                        return Math.round(remainingAmount / monthsLeft);
                    }
                    %>

                    <!-- Financial Goals Card -->
                    <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                        <i class="fas fa-bullseye"></i>
                        <span>Financial Goals</span>
                        </div>
                    </div>

                    <% financialGoals.forEach(goal => { 
                        const tipAmount = calculateMonthlySaving(goal);
                    %>
                        <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-title"><%= capitalize(goal.name) %></div>
                            <span class="badge badge-<%= goal.priority === 'critical' ? 'critical' : 'warning' %>">
                            <%= capitalize(goal.priority) %>
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <div style="font-size: 14px; color: var(--text-secondary);">
                            ₹<%= goal.targetAmount.toLocaleString('en-IN') %> by 
                            <%= new Date(goal.targetDate).toLocaleDateString('en-IN') %>
                            </div>
                            <div style="font-weight: 600;"><%= goal.progress %>%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: <%= goal.progress %>%"></div>
                        </div>

                        <!-- Savings Tip -->
                        <div style="margin-top: 20px; background: rgba(0, 200, 83, 0.1); padding: 16px; border-radius: 12px;">
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                            <i class="fas fa-lightbulb" style="color: var(--success); font-size: 20px;"></i>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 8px;">Savings Tip</div>
                                <div style="font-size: 14px;">
                                Save ₹<%= tipAmount.toLocaleString('en-IN') %>/month to hit your "<%= capitalize(goal.name) %>" goal by 
                                <%= new Date(goal.targetDate).toLocaleDateString('en-IN', { month: 'long', year: 'numeric' }) %>.
                                </div>
                            </div>
                            </div>
                        </div>
                        </div>
                    <% }); %>
                    </div>

                    <div style="height: 20px;"></div>

                    <!-- Support Resources Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-hands-helping"></i>
                                <span>Support Resources</span>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-icon">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <div>
                                <div>Budgeting Assistance</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Tools to help manage your expenses</div>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div>
                                <div>Job Search Resources</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Resume templates and interview prep</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer bg-dark-card py-8">
                <div class="max-w-6xl mx-auto px-4 w-full">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start text-sm text-gray-500">
            
                        <!-- Left: Logo + Brand -->
                        <div class="flex items-center space-x-3 justify-center md:justify-start">
                            <div class="w-10 h-10 bg-gold rounded-full flex items-center justify-center shadow-gold">
                                <i class="fas fa-coins text-dark-bg text-sm"></i>
                            </div>
                            <h2 class="text-xl font-montserrat font-bold text-gold">
                                Ruki<span class="text-white">AI</span>
                            </h2>
                        </div>
            
                        <!-- Center: Tagline + Description -->
                        <div class="text-center md:text-left flex flex-col items-center md:items-start">
                            <p>Secure Futurism Financial Dashboard</p>
                            <p class="mt-1">
                                © 2025 <span class="text-gold font-semibold">RukiAI</span>. All rights reserved.<br />
                                Your financial security is our priority.
                            </p>
                        </div>
            
                        <!-- Right: Social Icons -->
                        <div class="flex justify-center md:justify-end space-x-4">
                            <a href="#" class="text-gold hover:text-white transition text-lg">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="text-gold hover:text-white transition text-lg">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="#" class="text-gold hover:text-white transition text-lg">
                                <i class="fab fa-github"></i>
                            </a>
                        </div>
            
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <div class="notification-title">
                <i class="fas fa-bell"></i>
                <span>Weekly Reminder</span>
            </div>
            <button class="notification-close" id="close-notification">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-content">
            Remember to apply to 5 jobs this week and update your LinkedIn profile. 
            You have ₹<%= jobSearchDetails.jobSearchBudget.toLocaleString('en-IN') %>  allocated for job search activities.
        </div>
    </div>

</body>
<script>
    // Notification functionality
    document.addEventListener('DOMContentLoaded', function() {
        const notification = document.getElementById('notification');
        const closeBtn = document.getElementById('close-notification');
        
        // Show notification after 2 seconds
        setTimeout(() => {
            notification.classList.add('show');
        }, 2000);
        
        // Close notification
        closeBtn.addEventListener('click', () => {
            notification.classList.remove('show');
        });
        
        // Card hover effects
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-5px)';
                card.style.boxShadow = '0 8px 30px rgba(255, 215, 0, 0.1), 0 0 0 1px rgba(255, 215, 0, 0.3)';
            });
            
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.4)';
            });
        });
        
        // Resource card hover effects
        const resources = document.querySelectorAll('.resource-card');
        resources.forEach(resource => {
            resource.addEventListener('mouseenter', () => {
                resource.style.transform = 'translateX(5px)';
            });
            
            resource.addEventListener('mouseleave', () => {
                resource.style.transform = 'translateX(0)';
            });
        });
    });
</script>
</html>